Spring MVC (스프링 웹 MVC) 강의방향 안내

스프링 MVC의 두가지 버전

TomCat: 톰캣을 가지고 스프링없이 웹개발할수있다.
그떄는 web.xml에 설정했었는데 web.xml에다가 사용할라이브러리들을 썼다.
스프링을 쓰면 web.xml에 spring Dispatcher라는것을 쓴다.

Tomcat
Tomcat Configuration
-web.xml
	-Spring Dispatcher
	-MyBatis			//사용할 라이브러리들
	-Tiles			//사용할 라이브러리들
	-...


Tomcat
Tomcat Configuration
-web.xml
	-Spring Dispatcher
	


Spring Web
Spring Configuration
	-Servlet		|
	-Service		|
	-Security		}- XML,Annotation,java 로 설정한다.
	-MyBatis		|	
	-Tiles		|	
	-...

스프링 MVC는 프론트 컨트롤러를 제공한다.

web.xml에다가 spring Disapatcher를 올리면 스프링이 모든것을 관리하려고한다. Spring Configuration으로 mybatis,tiles등등이 옮겨지게된다.

설정하는 방법이 버전에따라서 달라졌다. 주로 현재 전자정부프레임은 xml+annotation 조금이고 현재는 Java로 Configuration하고있다. 
스프링을 가지고 개발하다보면 다 다른방식으로 개발해서 구분이 잘안되고 설정하는 것이 버전에따라서 달라서 

설정을 도와줄수있는 스프링부트가 나왔다. spring mvc를 대신하는것이아니고 설정을 모아서 편하게 설정할수있는 부가적인 프레임 워크이다. 스프링에다가 스프링부트를 얹으면 복잡한설정을 피할수있다.


Spring Boot
Starter Configuration	//Starter는 필요한것들 (servlet,service,security)등등을 묶어서 라이브러리로 가지고있다.
application.properties( 설정파일)		//일반적으로 이걸더 많이 쓰인다.
또는
YAML(설정파일)



-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Spring MVC (스프링 웹 MVC) 강의 01 - Spring MVC란

스프링이 제공하는 mvc가 무엇인지 알아보는 시간을 가지도록 하자

model1:컨트롤러가 개념적으로 존재, 그것을 출력을 담당하는 부분이 하나로 뭉쳐짐
 model2: 두개를 나누고, 컨트롤러는 서블릿으로 구현, jsp를 템플릿화면으로 뷰로 사용

dispatcher를 이용해서 포워딩을 했다. 모든 컨트롤러는 dispatcher기능을 다 구현해야하고 모든 컨트롤러에다가 가지고있는것은 비효율적인것 같다.
그래서 순수하게 컨트롤러 기능만 POJO로 구현할것이다. (Plain old java object) 평범한 자바 객체

컨트롤러가 빠진 Dispatcher가 남는다.
Dispatcher는의 기능은 view로 포워딩하는 기능이기때문에 기능이 거의다 똑같다. 그래서 Dispatcher하나만 둘수있다.

1. Dispatcher가 controller에게 사용자에게서 온 요청을 전달하고
2. 요청을 해서 결과물을 받아서 View로 전달

그런데 이 과정이 간단하지만은 않다. Dispatcher의 역할이 굉장이 중요하다.
사용자의 요청을 받는다는것은 단순하게 요청을 라우팅하는 역할이아니라 사용자가 전달하는 입력값이있으면 입력값을 Controller에게 사용하기 쉽게 포장해서 줄수도있다.
쉽게 포장해서주면 지금까지 했던것 servlet 이용해서 get 파라미터 이렇게 이용하는게 아니라 서블릿의 기능을 다차단할수있다.
Controller 에 기본적으로 사용할수있는 String int 등등으로 전달이 가능하다.

두번째는 단순하게 기본형으로 전달하는게아니라 어떤데이터를 개체화하는데 notice형 student형 등등으로 담아줄수있다. 서블릿라이브러리를 하나도 쓰지않고 입력을 처리할수있거나
Controller에서 말해놔서 view에 전달할때도 Controller에는 dispatcher기능이없다. 리턴할때 어떤 뷰페이지가 필요하다 라는 정보만 알려주면 Dispatcher가 View를 호출하면서 서블릿 기능을 Dispatcher로 한정할수있다.

이게바로 Dispatcher를 따로 분류하는 이유이다.

 Dispatcher와 Controller 결합력을 낮추게 함으로써 다른환경에서도 사용할수있게끔 하려고 한다.


Dispatcher를 만드는게 중요한데 Dispatcher만드는것을 스프링이 제공했다. 프론트컨트롤러를 잘만들게되면 톰캣과 이별할수도있다.



서블릿 디스패처 스프링이 제공한다.
모든 url요청이 오는데 적절하게 알맞은 컨트롤러에게 전달해야가기때문에  url을 어떤 controller가 처리할지를 가지고있어야한다. 설정파일이 필요하다. 과거에는 web.xml에서 설정하거나 annotation으로 설정했지만 
현재는 servlet.xml에 매핑정보를 쓰게된다.
스프링을 이용해서 컨트롤러를 이용하겠다는 것이다.

스프링 mvc는 라이브러리를 쓰는것인데 spring-webmvc에 있다.


-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Spring MVC (스프링 웹 MVC) 강의 02 - 실습환경 준비하기

스프링MVC를 실습을 통해서 MVC라이브러리를 쓰려면 실습환경을 준비해야한다.
실습환경
톰캣
jdk

개발환경도구
Spring에서 제공하는 개발환경도구

브라우저를 열고 spring.io접속 
그리고 사용할것은 spring Tools 4 for Eclipse를 다운하자 이 도구를 꼭 사용해야하는건 아니다. 설치하지않아도 라이브러리를 쓰면된다.
최신버전을 다운로드하자

다운로드해서 압축을 풀고 contents.zip을 잘라내기해서 tools(도구들 넣는 폴더) 에다가 sts-4.10.0.RELEASE를 넣어준다.

톰캣도 최신버전을 다운로드하자. 압축되있는 버전

부트를 사용하면 톰캣도 없어도 된다.
부트를 가지고 개발해도 좋으나


-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Spring MVC (스프링 웹 MVC) 강의 03 - 메이븐을 이용한 기본 웹 프로젝트 생성하기


지난시간에 spring web project를 만들기위해 실행환경으로써 톰캣을 다운받았고, 프로젝트를 개발하기 위해서 사용되는 스프링툴스를 받았다.
이것을 이용해서 빈프로젝트(스프링 배제하고 ,maven기반) 으로 만들고 다음시간에 spring을 다음시간에 얹는 작업을 할것이다.

프로젝트를 만들때 Create new Spring Starter Project는 스프링 부트를 기반으로 해서 만드는 프로젝트인데 스프링에 스프링부트를 얹은녀석이다.

오늘은 기본적인 웹프로젝트를 만들것이다. perspective -> javaEE-> Create a Maven project

Create a simple project(skip archetype selection) 체크
Use default Workspace location 체크

다음
packaging: war 로 변경

만들어지면 pom.xml에 빨간줄이 그어진다.  에러메세지는 web.xml이 없어서 에러가난것이다. web.xml 은 어디에 둬야하는가?
webapp안에 webinfo를 만들고 그안에다 둘것이다.


apache-tomcat-9.0.38/webapps/ROOT/WEB-INF 를 복사해서 src/main/webapp 에다가 넣어주면 된다. 이렇게 붙여넣어주면 pom.xml에 에러가 사라진다.

java resources를 보면 jdk가 1.5로 되어있다. pom.xml 에서 overview 로 가서 properties에서 create에서 Name: maven.compiler.source Value:1.8
로적어주면 추가가된다. 그리고 복사해서 붙여넣어서

 <maven.compiler.source>1.8</maven.compiler.source>		//1.8쓸거고
 <maven.compiler.target>1.8</maven.compiler.target>		//대상도 1.8버전이다.
그리고 보면 안바뀌어있다. pom.xml에 변경사항이 생긴다면 프로젝트에서 오른쪽 클릭을하고 maven-> update Project라는 버튼을 누르자
update를 하고나면 제대로 바뀌었다.

jsp 파일을 추가 할것인데 preference->Web->JSP Files
Korean,EUC-KR을 ISO 10646/Unicode(UTF-8)로 바꿔주도록 하자

html,css도 똑같이 바꿔주자

프로젝트->Properties->Resource-> 인코딩을 UTF-8로 바꿔주자

web-app 아래에 jsp파일을 추가해주면에러가난다. 왜 에러가나냐면? jsp 관련된 톰캣라이브러리가 없어서 그렇다.

pom.xml에 추가할것인데 구글에서 maven tomcat api 를 검색해서 톰캣 버전에맞게 클릭을 하면 코드가 뜨는데 그것을 복붙해주면된다.

-pom.xml
	.....	
	.....
  <packaging>war</packaging>
  <dependencies>
  <!-- https://mvnrepository.com/artifact/org.apache.tomcat/tomcat-api -->
	<dependency>
    	<groupId>org.apache.tomcat</groupId>
    	<artifactId>tomcat-api</artifactId>
    	<version>9.0.41</version>
	</dependency>
  </dependencies>
  <properties>
  	<maven.compiler.source>1.8</maven.compiler.source>
 	<maven.compiler.target>1.8</maven.compiler.target>
  </properties>
</project>

이렇게 하면 JSP파일에 에러가 사라진다. 
그리고 JSP 를 실행하면 실행환경이 구축이 안되어있다. apache Tomcat9.0을 설정하자
그리고 톰캣폴더를 지정해주자

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Spring MVC (스프링 웹 MVC) 강의 04 - Dispatcher Servlet 라이브러리 설정하기

maven 프로젝트를 만들어봤는데 그 프로젝트 위에 maven을 얹어 보도록해야겠다. 얹는다는것은 스프링이 프론트컨트롤러를 제공해
 그 프론트 컨트롤러 역할은 무엇인지 알아보는것도 중요하다.

Dispatcher에다가 Servlet관련된것을 넣고
Controller에 POJO를 만들것이다.

Dispatcher는 어떻게 구할것이냐? spring-webmvc 라이브러리안에 DispatcherServlet 이라는 클래스를 다운로드해야한다.
maven을 이용하게될경우 다운로드할경우 pom파일로 다운이 가능하다.

다운로드방법
1. 페이지방문해서 다운로드
2. window 메뉴-> show view-> maven repository-> Global Repository-> Rebuild index 또는 Update index 둘중에 하나를 선택하면 원격에있는 라이브러리를 가져온다.

원격에있는 저장소에 있는 라이브러리 목록으로 가져올수있다. 라이브러리를 가져오는것이 아니다.

Rebuild해놓으면 꽤 시간이 걸린다.  다음부터 다운받을 일이있으면 원격저장소에 index를 가지고 쉽게 추가할수있다.
Dependencies라는 탭이있다. Dependecies에 보면 유저인터페이스가 그래픽하게 보여진다.
Add를 눌러서 검색이 가능하다. 검색을 해서 라이브러리를 다운받을수 있는데 검색에있는 목록이 원격에있는게 아니라 인덱싱을한 내용가지고 검색을한다.

다운로드하면 원격에서 다운로드해서 가져온다.
일단은 인덱싱이 안되었기 때문에 페이지에가서 다운로드 받자.
https://mvnrepository.com 에서 spring framework 검색-> spring web클릭하고 최신버전을 다운해도 가능하지만

Spring Web MVC를 다운받으면 Spring Web이 필요하다 필요하게되면 자동으로 다운받아지니 Spring Web MVC의 최신버전을 다운받자
다운로드가 다되면 Libraries를 열어보면 JRE Maven Dependencies 두개가 있다.

pom.xml에 설정했던내용을 Maven Dependencies에 포함이되어있다. Maven을 쓰는 가장 중요한 이유는 하나를 다운받으면 그것에 필요한 Dependencies를 다운받아준다는것이다.

지금우리는 tomcat-api 와 spring-webmvc 두개만 다운로드했었는데 maven이 필요하니까 계층적으로 하위 라이브러리까지 다운로드해줬다.

maven을 쓰지않고 직접쓴다면 관련성있는 라이브러리 찾는것도 굉장히 오래걸린다. maven 덕분에 굉장히 쉽게 라이브러리 추가가 가능해졌다.
spring-webmvc 아래 servlet아래에 DispatcherServlet 이라는 클래스에다가 Copy qualified name을 하게되면 패키지명과 클래스명을 한번에 복사가 가능하다. 


-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Spring MVC (스프링 웹 MVC) 강의 05 - dispatcher-servlet.xml 파일

지난시간에 스프링을 사용하기 위한 라이브러리를 다운받아놨는데 그것을 이용해볼것이다.
그러기위해서는 스프링에서 제공하고있는 컨트롤러가 있는데 그 컨트롤러와 프론트 컨트롤러다. 그것을 사용하기위해 가장 중요한것은
dispatcher-servlet.xml이라는 xml파일이다.
 
xml파일의 의미와 용도를 알아보자

기본적인 mvc는 꼭 spring이 있어야하는건 아닌데 스프링없이 mvc를 구현하려고하면 컨트롤단이있어야하고 컨트롤 단에서 만들어낸 데이터를 가지고 화면을 출력해야한다.
index.jsp를 view라고 하고 모델을 컨트롤러가 심어서 전달을 해주면 모델데이터를 출력하는것을 해보자.

-index.jsp

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<h1>Hi ${data}</h1>
</body>	
</html>

기본적으로 컨트롤러를 만든다고 하면 그냥 클래스를 만들어서  extends HttpServlet 해도 되는데 
서블릿의 기능을 분리해서 누가 가져가냐? spring-mvc에서 Dispatcher-servlet.xml이 그역할 가져갈것이다.

컨트롤러를 POJO로 만들고 Dispatcher는 만들어져있는거라서 annotation으로 url 매핑을 할수가없다.

Dispatcher에다가 url매핑을 해야하는데 어디서하냐면 web.xml에다가한다.

-web.xml

<?xml version="1.0" encoding="UTF-8"?>

<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
  version="4.0"
  metadata-complete="true">

	<servlet>	<!--서블릿 설정할 클래스는 dispatcherServlet인데  -->
		<servlet-name>dispatcher</servlet-name>
		<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
	</servlet>
	<servlet-mapping><!-- 서블릿을 사용자가 요청할 수 있게끔 하는 매핑 주소가 있어야한다.  -->
		<servlet-name>dispatcher</servlet-name>
		<url-pattern>/</url-pattern><!-- 주소를 쓰는데 프론트 컨트롤러여서 모든 /로 시작하는 url을 받을것이다. 각각의 포조클래스를 분배해주게 되어있다. -->
	</servlet-mapping>

  <display-name>Welcome to Tomcat</display-name>
  <description>
     Welcome to Tomcat
  </description>
</web-app>

이렇게하면 서비스 설정 끝난것이다.

Hi라는 페이지가나온다. 우리가 원했던건 프론트 컨트롤러 를 만들었다. 모든 주소를 받아들이고 어떠한 요청이와도 프론트컨트롤러가 매핑하지않은 url은
url은 나오면 안된다. 이거는 안되는것이다

뭐가잘못된것이냐면

<url-pattern>/</url-pattern> 모든것이 통과한다. 
<url-pattern>/*</url-pattern>//어떤 url도 허락하지않으면 통과하지않는다. 로 바꾸고 실행을 해보자

web-INF안에 Dispatcehr 서블릿이 없다는 에러가 나온다.


disapatcher를 이용하려고 하는데 서블릿으로 설정했고 모든 URL에 대해서 받겠다. index.jsp라고 요청이왔는데 적절한 url에 맞는 리소스를 배분해줘야하는데
매핑정보가 필요하다. *-servlet.xml 이 약속되어있는 위치에 있어야한다. 기본위치는 -servlet.xml이 있어야한다.
설정파일이없으니까 매핑할수도없었다.

그렇다면 WEB-INF/dispatcher-servlet.xml 파일을 만들자.

그리고 이파일에다가는 무엇을 넣어야할까 다음시간에 알아보자




-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


